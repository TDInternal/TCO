<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Cost Comparison Calculator</title>
    <style>
        :root {
            --td-blue: #00aeef;
            --td-green: #8dc73f;
            --td-orange: #f57922;
            --td-yellow: #ffcf03;
            --td-teal: #019c96;
            --td-red: #ee4124;
            --td-purple: #7f3f98;
            --td-maroon: #71002a;
            --text-dark: #1e293b;
            --text-light: #f8fafc;
            --bg-light: #f1f5f9;
            --border-light: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-light);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow: 0 32px 64px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            animation: slideUp 0.8s ease-out;
            border: 1px solid var(--border-light);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: var(--td-blue);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .main-content {
            padding: 40px;
        }

        .controls {
            background: rgba(248, 250, 252, 0.8);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
            border: 1px solid var(--border-light);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }

        .control-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
        }
        
        .control-section h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--td-blue);
        }

        .control-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .control-group label {
            min-width: 280px;
            font-weight: 500;
            color: #374151;
            font-size: 0.95rem;
        }

        /* Remove arrows from number inputs */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type=number] {
          -moz-appearance: textfield;
        }

        .control-group input {
            padding: 12px 16px;
            border: 2px solid var(--border-light);
            border-radius: 12px;
            width: 140px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            background: white;
        }

        .control-group input:focus {
            outline: none;
            border-color: var(--td-blue);
            box-shadow: 0 0 0 4px rgba(0, 174, 239, 0.15);
        }

        .control-group input:read-only,
        .control-group input:disabled {
            background-color: var(--bg-light);
            color: #64748b;
            cursor: not-allowed;
        }
        
        /* Custom Checkbox styles */
        .checkbox-group { display: flex; align-items: center; gap: 12px; }
        .custom-checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            gap: 12px;
            min-width: auto;
        }
        .checkbox-group input[type="checkbox"] {
            display: none;
        }
        .checkmark {
            position: relative;
            height: 20px;
            width: 20px;
            background-color: #eee;
            border: 2px solid var(--border-light);
            border-radius: 4px;
            transition: all 0.2s;
        }
        .custom-checkbox-container:hover .checkmark {
            background-color: #ccc;
        }
        input[type="checkbox"]:checked + .checkmark {
            background-color: var(--td-blue);
            border-color: var(--td-blue);
        }
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }
        input[type="checkbox"]:checked + .checkmark:after {
            display: block;
        }
        .checkmark:after {
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }


        .preset-section {
            text-align: center; margin: 32px 0; padding: 24px;
            background: #f7f9fc; border-radius: 16px;
            border: 1px solid var(--border-light);
        }

        .preset-section h3 { font-size: 1.2rem; font-weight: 600; margin-bottom: 16px; color: var(--text-dark); }

        .preset-btn {
            background: var(--td-blue);
            color: white; border: none; padding: 14px 28px; margin: 8px; border-radius: 12px;
            cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 174, 239, 0.2);
        }

        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 174, 239, 0.3);
        }

        .preset-btn.secondary { background: #475569; box-shadow: 0 4px 15px rgba(100, 116, 139, 0.2); }
        .preset-btn.secondary:hover { box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3); }

        .table-container {
            background: white; border-radius: 20px; overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-light);
            margin-bottom: 32px;
        }

        table { width: 100%; border-collapse: collapse; }

        th {
            background: var(--text-dark); color: white;
            padding: 18px 16px; text-align: left; font-size: 14px;
            font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;
        }

        td {
            padding: 14px 16px; border-bottom: 1px solid var(--border-light);
            font-size: 14px; transition: background-color 0.2s ease;
        }

        tr:last-child td { border-bottom: none; }
        tr:hover td { background-color: #f8fafc; }

        .category-header td {
            font-weight: 700; color: var(--text-dark); border-bottom: 2px solid var(--border-light);
            font-size: 15px; background-color: var(--bg-light) !important;
        }

        .total-row td {
            font-weight: 600; color: var(--td-blue); background-color: rgba(0, 174, 239, 0.05) !important;
            border-top: 1px solid rgba(0, 174, 239, 0.2);
            border-bottom: 1px solid rgba(0, 174, 239, 0.2);
        }
        
        .grand-total td {
            background: var(--td-blue) !important; color: white !important;
            font-weight: 700; font-size: 16px;
        }

        .price { text-align: right; font-family: 'Inter', sans-serif; font-weight: 600; }

        .sources-column { font-size: 12px; color: #64748b; max-width: 200px; line-height: 1.4; }
        .link-style { color: var(--td-blue); text-decoration: none; font-weight: 500; }
        .link-style:hover { text-decoration: underline; }
        
        .summary-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-dark);
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--td-blue);
        }

        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 32px; }
        .summary-box {
            background: white; border-radius: 20px; padding: 32px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); border: 1px solid var(--border-light);
        }
        .summary-box h3 { font-size: 1.5rem; font-weight: 700; color: var(--text-dark); margin-bottom: 24px; text-align: center; }
        .summary-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
        
        .stat-box {
            background: var(--bg-light); padding: 20px; border-radius: 16px; text-align: center;
            border: 2px solid var(--border-light);
        }

        .stat-value {
            font-size: 1.8rem; font-weight: 800; color: var(--td-blue);
            margin-bottom: 4px;
        }

        .stat-label { font-size: 12px; color: #64748b; font-weight: 500; text-transform: uppercase; }

        .summary-percentage {
            text-align: center; font-size: 1.2rem; font-weight: 600; padding: 16px;
            border-radius: 12px; border: 1px solid rgba(0,0,0,0.1);
        }
        
        .summary-percentage.savings { background-color: rgba(141, 199, 63, 0.1); color: #5a7e29; }
        .summary-percentage.cost { background-color: rgba(238, 65, 36, 0.1); color: var(--td-red); }
        .summary-percentage.neutral { background-color: var(--bg-light); color: #64748b; }

        #summary-table td:first-child {
             border-left: 5px solid;
             font-weight: 600;
        }

        #summary-row-1 td:first-child { border-left-color: var(--td-green); }
        #summary-row-2 td:first-child { border-left-color: var(--td-orange); }
        #summary-row-3 td:first-child { border-left-color: var(--td-red); }
        #summary-row-4 td:first-child { border-left-color: var(--td-purple); }
        #summary-fte-row td:first-child { border-left-color: var(--td-maroon); }


        .loading-spinner {
            display: none; width: 24px; height: 24px;
            border: 3px solid var(--border-light); border-top: 3px solid var(--td-blue);
            border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            .container { margin: 10px; border-radius: 16px; }
            .header { padding: 24px; }
            .header h1 { font-size: 2rem; }
            .main-content { padding: 20px; }
            .control-group { flex-direction: column; align-items: stretch; gap: 8px; }
            .control-group label, .custom-checkbox-container { min-width: auto; }
            .control-group input { width: 100%; }
            .summary-grid { grid-template-columns: 1fr; }
            .summary-stats { grid-template-columns: 1fr; }
        }

        .floating-action {
            position: fixed; bottom: 24px; right: 24px;
            background: var(--td-blue); color: white; border: none; border-radius: 50%;
            width: 60px; height: 60px; cursor: pointer;
            box-shadow: 0 8px 25px rgba(0, 174, 239, 0.4);
            transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; font-size: 24px;
        }
        .floating-action:hover { transform: scale(1.1); box-shadow: 0 12px 35px rgba(0, 174, 239, 0.5); }

        @media print {
            body { background: none; padding: 0; }
            .container { box-shadow: none; border-radius: 0; backdrop-filter: none; max-width: 100%; margin: 0; }
            .header, .controls, .floating-action { display: none; }
            .main-content { padding: 0; }
            .summary-box, .table-container { box-shadow: none; border: 1px solid #ccc; page-break-inside: avoid; }
            .summary-grid { grid-template-columns: 1fr; }
            .table-container { margin-bottom: 20px;}
            h2.summary-title { margin-top: 30px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💰 Cost Comparison Calculator</h1>
            <p>Terra Dotta ISSS Hosted Solution vs Sunapsis On-Premise Deployment</p>
        </div>
        
        <div class="main-content">
            <div class="controls">
                <div class="control-section">
                    <h4>🚀 Terra Dotta Solution Costs</h4>
                    <div class="control-group">
                        <label for="td-software">Terra Dotta Software License (Year 1):</label>
                        <input type="number" id="td-software" value="" placeholder="Enter amount" oninput="updateTable()">
                    </div>
                    <div class="control-group">
                        <label></label>
                        <a href="https://terradotta-my.sharepoint.com/:x:/r/personal/george_hogan_terradotta_com/_layouts/15/Doc.aspx?sourcedoc=%7B0BDD0173-4CB1-4711-BF37-A86CB0C71E32%7D&file=Pricing%20&%20Calculator.xlsx=&action=default&mobileredirect=true" target="_blank" class="link-style">📊 Terra Dotta Pricing Matrix</a>
                    </div>
                    <div class="control-group">
                        <label for="td-implementation">Terra Dotta Implementation Services (Year 1):</label>
                        <input type="number" id="td-implementation" value="" placeholder="Enter amount" oninput="updateTable()">
                    </div>
                </div>
                
                <div class="preset-section">
                    <h3>⚡ Quick Configuration Presets</h3>
                    <button class="preset-btn" onclick="loadCurrentMarket()">📈 2025 Market Rates</button>
                    <button class="preset-btn secondary" onclick="loadInstitutionalIT()">🏛️ Institutional IT Inputs</button>
                </div>
                
                <div class="control-section">
                    <h4>📦 Sunapsis Software Licensing Costs</h4>
                    <div class="control-group">
                        <label for="isss-license">ISSS License:</label>
                        <input type="number" id="isss-license" value="" placeholder="Enter amount" oninput="updateTable()">
                    </div>
                    <div class="control-group">
                        <label></label>
                        <a href="https://sunapsis.iu.edu/pricing.html" target="_blank" class="link-style">📋 Sunapsis Pricing Matrix</a>
                    </div>
                    <div class="control-group">
                        <label for="isss-implementation">ISSS Implementation Cost:</label>
                        <input type="text" id="isss-implementation" value="$8,100" readonly>
                    </div>
                    <div class="control-group checkbox-group">
                        <div style="min-width: 280px;">
                             <label class="custom-checkbox-container">
                                 <input type="checkbox" id="dedicated-it-checkbox" onchange="updateTable()">
                                 <span class="checkmark"></span>
                                 <span>👨‍💻 Dedicated IT FTE for Sunapsis:</span>
                             </label>
                        </div>
                        <input type="number" id="dedicated-it-cost" value="72000" placeholder="72000" oninput="updateTable()" disabled>
                    </div>
                    <div class="control-group">
                        <label for="windows-license">🖥️ Windows Server License:</label>
                        <input type="text" id="windows-license" value="$1,150" readonly>
                    </div>
                    <div class="control-group">
                        <label for="coldfusion-license">⚙️ ColdFusion Server License:</label>
                        <input type="text" id="coldfusion-license" value="$2,930" readonly>
                    </div>
                    <div class="control-group">
                        <label for="sql-license">🗄️ SQL Server Enterprise License:</label>
                        <input type="text" id="sql-license" value="$28,000" readonly>
                    </div>
                    <div class="control-group">
                        <label for="ssl-license">🔒 SSL Certificates:</label>
                        <input type="text" id="ssl-license" value="$500" readonly>
                    </div>
                </div>
                
                <div class="control-section">
                    <h4>🔧 Sunapsis Implementation & Support Costs</h4>
                    <div class="control-group">
                        <label for="support-services">🎯 Support Services:</label>
                        <input type="text" id="support-services" value="$7,500" readonly>
                    </div>
                    <div class="control-group">
                        <label for="integration">🔗 Integration Services:</label>
                        <input type="text" id="integration" value="$8,400" readonly>
                    </div>
                    <div class="control-group">
                        <label for="migration">📁 Legacy Data Migration:</label>
                        <input type="text" id="migration" value="$2,800" readonly>
                    </div>
                    <div class="control-group">
                        <label for="admin">⚙️ System Administration (25% FTE):</label>
                        <input type="text" id="admin" value="$18,200" readonly>
                    </div>
                </div>
                
                <div class="control-section">
                    <h4>🖥️ Sunapsis Hardware Infrastructure</h4>
                    <div class="control-group">
                        <label for="app-server-prod">🚀 Application Server - Production:</label>
                        <input type="text" id="app-server-prod" value="$2,000" readonly>
                    </div>
                    <div class="control-group">
                        <label for="app-server-test">🧪 Application Server - Test:</label>
                        <input type="text" id="app-server-test" value="$2,000" readonly>
                    </div>
                    <div class="control-group">
                        <label for="db-server">🗄️ Database Server:</label>
                        <input type="text" id="db-server" value="$2,000" readonly>
                    </div>
                    <div class="control-group">
                        <label for="file-storage">💾 File Storage:</label>
                        <input type="text" id="file-storage" value="$1,250" readonly>
                    </div>
                </div>
            </div>

            <div class="loading-spinner" id="loading"></div>

            <div class="table-container fade-in">
                <table id="cost-table">
                    <thead>
                        <tr>
                            <th style="width: 35%;">💼 Cost Category</th>
                            <th style="width: 20%;">🌟 Terra Dotta Hosted</th>
                            <th style="width: 20%;">🏢 Sunapsis On-Premise</th>
                            <th style="width: 25%;">📚 Sources & Notes</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Table content will be generated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <div id="summary-section" class="fade-in">
                <h2 class="summary-title">Cost Category Summary</h2>
                <div class="table-container">
                    <table id="summary-table">
                         <thead>
                            <tr>
                                <th style="width: 45%;">Cost Category</th>
                                <th style="width: 27.5%;">🌟 Terra Dotta Hosted</th>
                                <th style="width: 27.5%;">🏢 Sunapsis On-Premise</th>
                            </tr>
                        </thead>
                        <tbody id="summary-table-body">
                           <!-- Summary rows generated by JS -->
                        </tbody>
                        <tfoot id="summary-table-footer">
                           <!-- Total row generated by JS -->
                        </tfoot>
                    </table>
                </div>
            </div>
            
            <div class="summary-grid">
                <div class="summary-box fade-in">
                    <h3>📊 Year 1 Cost Analysis</h3>
                    <div class="summary-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="hosted-total">$0</div>
                            <div class="stat-label">Terra Dotta</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="sunapsis-total">$0</div>
                            <div class="stat-label">Sunapsis</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="savings-amount">$0</div>
                            <div class="stat-label" id="savings-label">Difference</div>
                        </div>
                    </div>
                    <div class="summary-percentage neutral" id="savings-percentage">Enter costs to see comparison</div>
                </div>
                
                <div class="summary-box fade-in">
                    <h3>📈 5-Year Total Cost of Ownership</h3>
                    <div class="summary-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="hosted-5year">$0</div>
                            <div class="stat-label">Terra Dotta 5-Year</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="sunapsis-5year">$0</div>
                            <div class="stat-label">Sunapsis 5-Year</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="savings-5year">$0</div>
                            <div class="stat-label" id="savings-5year-label">5-Year Difference</div>
                        </div>
                    </div>
                    <div class="summary-percentage neutral" id="savings-5year-percentage">Enter values to see 5-year analysis</div>
                </div>
            </div>
        </div>
    </div>

    <button class="floating-action" onclick="window.print()" title="Print Report">🖨️</button>

    <script>
        function getValue(id) {
            const element = document.getElementById(id);
            if (!element) return 0;
            let value = element.value || '0';
            value = value.toString().replace(/[$,]/g, '');
            return parseFloat(value) || 0;
        }

        function formatCurrency(amount) {
            return '$' + amount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function updateTable() {
            showLoading();
            
            setTimeout(() => {
                // Handle checkbox logic
                const isDedicatedIT = document.getElementById('dedicated-it-checkbox').checked;
                const dedicatedITCostInput = document.getElementById('dedicated-it-cost');
                dedicatedITCostInput.disabled = !isDedicatedIT;

                // Get all input values
                const tdSoftware = getValue('td-software');
                const tdImplementation = getValue('td-implementation');
                const isssLicense = getValue('isss-license');
                const dedicatedITCost = isDedicatedIT ? getValue('dedicated-it-cost') : 0;

                const sunapsisCosts = {
                    isssImplementation: getValue('isss-implementation'),
                    windows: getValue('windows-license'),
                    coldfusion: getValue('coldfusion-license'),
                    sql: getValue('sql-license'),
                    ssl: getValue('ssl-license'),
                    support: getValue('support-services'),
                    integration: getValue('integration'),
                    migration: getValue('migration'),
                    admin: getValue('admin'),
                    appProd: getValue('app-server-prod'),
                    appTest: getValue('app-server-test'),
                    db: getValue('db-server'),
                    storage: getValue('file-storage')
                };

                // Calculate sub-totals for summary table
                const tdSoftwareAndImpTotal = tdSoftware + tdImplementation;
                const sunSoftwareAndImpTotal = isssLicense + sunapsisCosts.isssImplementation;

                const sunLicensingTotal = sunapsisCosts.windows + sunapsisCosts.coldfusion + sunapsisCosts.sql + sunapsisCosts.ssl;
                const sunHiddenImpTotal = sunapsisCosts.integration + sunapsisCosts.migration + (isDedicatedIT ? 0 : sunapsisCosts.admin);
                const sunInfraTotal = sunapsisCosts.appProd + sunapsisCosts.appTest + sunapsisCosts.db + sunapsisCosts.storage;

                // Main table calculations
                const tdYear1Total = tdSoftwareAndImpTotal;
                const sunYear1Total = sunSoftwareAndImpTotal + sunLicensingTotal + sunHiddenImpTotal + sunInfraTotal + dedicatedITCost;
                
                // Ongoing Annual Costs
                const tdAnnualCost = tdSoftware;
                const sunAnnualCost = isssLicense + sunLicensingTotal + (isDedicatedIT ? 0 : sunapsisCosts.admin) + dedicatedITCost;


                // Populate main table
                document.getElementById('table-body').innerHTML = `
                    <tr class="category-header"><td colspan="4"><strong>💼 Year 1 Software and Implementation Cost</strong></td></tr>
                    <tr><td>🎓 International Students & Scholars License</td><td class="price">${formatCurrency(tdSoftware)}</td><td class="price">${formatCurrency(isssLicense)}</td><td class="sources-column">Institutional licensing for SEVIS management software varies by vendor.<br><a href="https://sunapsis.iu.edu/pricing.html" target="_blank" class="link-style">📋 Sunapsis Pricing</a></td></tr>
                    <tr><td>⚙️ ISSS Implementation Cost</td><td class="price">${formatCurrency(tdImplementation)}</td><td class="price">${formatCurrency(sunapsisCosts.isssImplementation)}</td><td class="sources-column">Implementation costs for ISSS system setup and configuration.<br><a href="https://sunapsis.iu.edu/implementation.html" target="_blank" class="link-style">🔧 Sunapsis Implementation Guide</a></td></tr>
                    <tr class="total-row"><td><strong>💰 Total Software & Implementation</strong></td><td class="price"><strong>${formatCurrency(tdSoftwareAndImpTotal)}</strong></td><td class="price"><strong>${formatCurrency(sunSoftwareAndImpTotal)}</strong></td><td></td></tr>
                    
                    <tr class="category-header"><td colspan="4"><strong>🖥️ Server Software Licensing</strong></td></tr>
                    <tr><td>🖥️ Windows Server License</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.windows)}</td><td class="sources-column">Microsoft Windows Server 2025 Standard 16-core.<br><a href="https://www.microsoft.com/en-us/windows-server/pricing" target="_blank" class="link-style">💻 Microsoft Pricing</a></td></tr>
                    <tr><td>⚙️ ColdFusion Server License</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.coldfusion)}</td><td class="sources-column">Adobe ColdFusion 2025 Enterprise.<br><a href="https://www.adobe.com/products/coldfusion/pricing.html" target="_blank" class="link-style">🎨 Adobe Pricing</a></td></tr>
                    <tr><td>🗄️ SQL Server Enterprise License</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.sql)}</td><td class="sources-column">SQL Server Enterprise: ~$7,000/core, 4-core min.<br><a href="https://www.microsoft.com/en-us/sql-server/sql-server-2022-pricing" target="_blank" class="link-style">💾 SQL Server Pricing</a></td></tr>
                    <tr><td>🔒 SSL Certificates</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.ssl)}</td><td class="sources-column">DigiCert SSL certificates.<br><a href="https://www.digicert.com/tls-ssl/compare-certificates" target="_blank" class="link-style">🔐 DigiCert Pricing</a></td></tr>
                    <tr class="total-row"><td><strong>💻 Total Software Licensing</strong></td><td class="price"><strong>✨ Included</strong></td><td class="price"><strong>${formatCurrency(sunLicensingTotal)}</strong></td><td></td></tr>

                    <tr class="category-header"><td colspan="4"><strong>🔧 Hidden Implementation Fees</strong></td></tr>
                    <tr><td>🔗 Integration Services</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.integration)}</td><td class="sources-column">Complexity varies with existing systems.<br><a href="https://sunapsis.iu.edu/services/integration.html" target="_blank" class="link-style">🔧 Integration Info</a></td></tr>
                    <tr><td>📁 Legacy Data Migration</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.migration)}</td><td class="sources-column">Depends on data volume and complexity.<br><a href="https://sunapsis.iu.edu/services/migration.html" target="_blank" class="link-style">📦 Migration Info</a></td></tr>
                    <tr><td>⚙️ System Administration (25% FTE)</td><td class="price">✅ Included</td><td class="price">${isDedicatedIT ? '👨‍💻 FTE Below' : formatCurrency(sunapsisCosts.admin)}</td><td class="sources-column">25% FTE for on-premise deployments.<br><a href="https://www.bls.gov/ooh/computer-and-information-technology/network-and-computer-systems-administrators.htm" target="_blank" class="link-style">📊 BLS Data</a></td></tr>
                    <tr class="total-row"><td><strong>🚫 Total Hidden Implementation</strong></td><td class="price"><strong>✨ Included</strong></td><td class="price"><strong>${formatCurrency(sunHiddenImpTotal)}</strong></td><td></td></tr>

                    <tr class="category-header"><td colspan="4"><strong>🏗️ Server Infrastructure</strong></td></tr>
                    <tr><td>🚀 Application Server - Production</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.appProd)}</td><td class="sources-column">Varies by specs and vendor.<br><a href="https://www.dell.com/en-us/work/shop/servers/sr/servers" target="_blank" class="link-style">🖥️ Dell Pricing</a></td></tr>
                    <tr><td>🧪 Application Server - Test</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.appTest)}</td><td class="sources-column">Matches production specs.<br><a href="https://www.hpe.com/us/en/servers/proliant-dl-servers.html" target="_blank" class="link-style">⚡ HPE Options</a></td></tr>
                    <tr><td>🗄️ Database Server</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.db)}</td><td class="sources-column">Depends on data volume.<br><a href="https://aws.amazon.com/rds/sqlserver/pricing/" target="_blank" class="link-style">☁️ AWS RDS Pricing</a></td></tr>
                    <tr><td>💾 File Storage</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunapsisCosts.storage)}</td><td class="sources-column">Depends on capacity needs.<br><a href="https://www.netapp.com/data-storage/fas/" target="_blank" class="link-style">📦 NetApp Solutions</a></td></tr>
                    <tr class="total-row"><td><strong>🏗️ Total Infrastructure</strong></td><td class="price"><strong>✨ Included</strong></td><td class="price"><strong>${formatCurrency(sunInfraTotal)}</strong></td><td></td></tr>
                    ${isDedicatedIT ? `<tr class="category-header"><td colspan="4"><strong>👨‍💻 Additional IT Costs</strong></td></tr>
                    <tr><td>👨‍💻 Dedicated IT FTE for Sunapsis</td><td class="price">✅ Included</td><td class="price">${formatCurrency(dedicatedITCost)}</td><td>Full-time dedicated IT staff.</td></tr>` : ''}
                    <tr class="grand-total"><td ><strong>💸 Total Year 1 Cost</strong></td><td class="price"><strong>${formatCurrency(tdYear1Total)}</strong></td><td class="price"><strong>${formatCurrency(sunYear1Total)}</strong></td><td></td></tr>
                `;

                // Populate Summary Table
                let summaryFteRow = '';
                if (isDedicatedIT) {
                    summaryFteRow = `<tr id="summary-fte-row"><td>Annual Cost: Dedicated IT FTE for Sunapsis</td><td class="price">✅ Included</td><td class="price">${formatCurrency(dedicatedITCost)}</td></tr>`;
                }
                
                document.getElementById('summary-table-body').innerHTML = `
                    <tr id="summary-row-1"><td>Total Year 1 Software and Implementation Cost</td><td class="price">${formatCurrency(tdSoftwareAndImpTotal)}</td><td class="price">${formatCurrency(sunSoftwareAndImpTotal)}</td></tr>
                    <tr id="summary-row-2"><td>Total Ongoing Server Software Licensing Cost</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunLicensingTotal)}</td></tr>
                    <tr id="summary-row-3"><td>Total Hidden Implementation Cost</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunHiddenImpTotal)}</td></tr>
                    <tr id="summary-row-4"><td>Total Ongoing Server Infrastructure Cost</td><td class="price">✅ Included</td><td class="price">${formatCurrency(sunInfraTotal)}</td></tr>
                    ${summaryFteRow}
                `;
                
                // Populate Summary Table Footer
                document.getElementById('summary-table-footer').innerHTML = `
                    <tr class="total-row" style="font-weight: bold;">
                        <td>Ongoing Annual Cost</td>
                        <td class="price">${formatCurrency(tdAnnualCost)}</td>
                        <td class="price">${formatCurrency(sunAnnualCost)}</td>
                    </tr>
                    <tr class="grand-total">
                        <td><strong>💸 Total Year 1 Cost</strong></td>
                        <td class="price"><strong>${formatCurrency(tdYear1Total)}</strong></td>
                        <td class="price"><strong>${formatCurrency(sunYear1Total)}</strong></td>
                    </tr>
                `;


                // Update summary cards
                const difference = sunYear1Total - tdYear1Total;
                const savingsPercentage = sunYear1Total > 0 ? ((difference / sunYear1Total) * 100) : 0;
                
                document.getElementById('hosted-total').textContent = formatCurrency(tdYear1Total);
                document.getElementById('sunapsis-total').textContent = formatCurrency(sunYear1Total);
                document.getElementById('savings-amount').textContent = formatCurrency(Math.abs(difference));
                
                const savingsPercentageEl = document.getElementById('savings-percentage');
                if (tdYear1Total === 0 && sunYear1Total === 0) {
                    savingsPercentageEl.textContent = 'Enter costs to see comparison';
                    savingsPercentageEl.className = 'summary-percentage neutral';
                } else if (difference > 0) {
                    document.getElementById('savings-label').textContent = 'Savings with Terra Dotta';
                    savingsPercentageEl.textContent = `🎉 ${savingsPercentage.toFixed(1)}% savings with Terra Dotta`;
                    savingsPercentageEl.className = 'summary-percentage savings';
                } else {
                    document.getElementById('savings-label').textContent = 'Additional Cost';
                    savingsPercentageEl.textContent = `🔺 ${Math.abs(savingsPercentage).toFixed(1)}% more expensive`;
                    savingsPercentageEl.className = 'summary-percentage cost';
                }

                // 5-year calculations
                const td5Year = tdImplementation + (tdSoftware * 5);
                const sun5Year = sunapsisCosts.isssImplementation + sunapsisCosts.integration + sunapsisCosts.migration + sunInfraTotal + (sunAnnualCost * 5);
                
                const difference5Year = sun5Year - td5Year;
                const savingsPercentage5Year = sun5Year > 0 ? ((difference5Year / sun5Year) * 100) : 0;
                
                document.getElementById('hosted-5year').textContent = formatCurrency(td5Year);
                document.getElementById('sunapsis-5year').textContent = formatCurrency(sun5Year);
                document.getElementById('savings-5year').textContent = formatCurrency(Math.abs(difference5Year));
                
                const savings5YearPercentageEl = document.getElementById('savings-5year-percentage');
                if (td5Year === 0 && sun5Year === 0) {
                    savings5YearPercentageEl.textContent = 'Enter values for 5-year analysis';
                    savings5YearPercentageEl.className = 'summary-percentage neutral';
                } else if (difference5Year > 0) {
                    document.getElementById('savings-5year-label').textContent = '5-Year Savings with Terra Dotta';
                    savings5YearPercentageEl.textContent = `🚀 ${savingsPercentage5Year.toFixed(1)}% savings over 5 years`;
                    savings5YearPercentageEl.className = 'summary-percentage savings';
                } else {
                    document.getElementById('savings-5year-label').textContent = '5-Year Additional Cost';
                    savings5YearPercentageEl.textContent = `📈 ${Math.abs(savingsPercentage5Year).toFixed(1)}% more expensive over 5 years`;
                    savings5YearPercentageEl.className = 'summary-percentage cost';
                }

                hideLoading();
            }, 300);
        }

        function loadCurrentMarket() {
            // This function resets fields to their default read-only state
            const fields = [
                ['windows-license', '$1,150'], ['coldfusion-license', '$2,930'], ['sql-license', '$28,000'],
                ['ssl-license', '$500'], ['support-services', '$7,500'], ['integration', '$8,400'],
                ['migration', '$2,800'], ['admin', '$18,200'], ['app-server-prod', '$2,000'],
                ['app-server-test', '$2,000'], ['db-server', '$2,000'], ['file-storage', '$1,250']
            ];
            
            fields.forEach(([fieldId, value]) => {
                const el = document.getElementById(fieldId);
                if (el) {
                    el.type = 'text';
                    el.value = value;
                    el.readOnly = true;
                    el.oninput = null;
                }
            });
            document.getElementById('dedicated-it-checkbox').checked = false;
            updateTable();
        }

        function loadInstitutionalIT() {
             // This function makes fields editable for custom institutional values
            const fields = [
                ['windows-license', 1150], ['coldfusion-license', 2930], ['sql-license', 28000],
                ['ssl-license', 500], ['support-services', 7500], ['integration', 8400],
                ['migration', 2800], ['admin', 18200], ['app-server-prod', 2000],
                ['app-server-test', 2000], ['db-server', 2000], ['file-storage', 1250]
            ];
            
            fields.forEach(([fieldId, value]) => {
                const el = document.getElementById(fieldId);
                if (el) {
                    el.type = 'number';
                    el.value = value;
                    el.readOnly = false;
                    el.oninput = updateTable;
                }
            });
            updateTable();
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateTable();
        });
    </script>
</body>
</html>
